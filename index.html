<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProebalStars</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .content {
            display: none;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ */
        .rating-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }

        .rating-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .rating-wrapper {
            background: var(--tg-theme-bg-color, #ffffff);
            border-radius: 12px;
            overflow: hidden;
        }

        .rating-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 8px 0;
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 10px;
            transition: transform 0.2s ease;
        }

        .rating-position {
            width: 30px;
            text-align: center;
            font-weight: bold;
        }

        .rating-medal {
            width: 30px;
            text-align: center;
            font-size: 20px;
        }

        .rating-info {
            flex: 1;
            margin-left: 10px;
        }

        .rating-username {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .rating-stars {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–≥—Ä—ã */
        .game-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        .game-header {
            margin-bottom: 30px;
        }

        .game-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 15px 30px;
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .game-button:active {
            transform: scale(0.98);
        }

        .game-button-icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .game-info {
            text-align: center;
            color: var(--tg-theme-text-color);
        }

        .telegram-note {
            color: var(--tg-theme-hint-color);
            font-size: 14px;
            margin-top: 20px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: var(--tg-theme-bg-color);
            border-top: 1px solid rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-button {
            border: none;
            background: none;
            padding: 10px;
            color: var(--tg-theme-hint-color);
            cursor: pointer;
            font-size: 14px;
            transition: color 0.2s;
        }

        .nav-button.active {
            color: var(--tg-theme-button-color);
        }
    </style>
</head>
<body>
    <!-- –í–∫–ª–∞–¥–∫–∞ "–†–µ–π—Ç–∏–Ω–≥" -->
    <div id="rating" class="content">
        <div class="rating-container">
            <div class="rating-header">
                <h2>üèÜ –†–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ—ë–±–∞ Stars</h2>
            </div>
            <div class="rating-wrapper" id="ratingList">
                <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Ä–µ–π—Ç–∏–Ω–≥ -->
            </div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–ò–≥—Ä–∞" -->
    <div id="game" class="content">
        <div class="game-container">
            <div class="game-header">
                <h2>‚è± –ü—Ä–æ—ë–± –≤—Ä–µ–º–µ–Ω–∏</h2>
            </div>
            <button class="game-button" onclick="toggleGame()" id="gameButton">
                <span class="game-button-icon">‚ñ∂Ô∏è</span>
                <span class="game-button-text">–ù–∞—á–∞—Ç—å –ø—Ä–æ—ë–± –≤—Ä–µ–º–µ–Ω–∏</span>
            </button>
            <div class="game-info">
                <p>‚è± –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: <span id="gameTime">0</span> —Å–µ–∫—É–Ω–¥</p>
                <p>üèÜ –†–µ–∫–æ—Ä–¥ —Å–µ—Å—Å–∏–∏: <span id="gameRecord">0</span> —Å–µ–∫—É–Ω–¥</p>
                <p>üåü Stars –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥!</p>
                <p class="telegram-note">üì± –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è Stars –æ—Ç–∫—Ä–æ–π—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ Telegram</p>
            </div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ "–û –Ω–∞—Å" -->
    <div id="about" class="content">
        <h2>üåü –û –ø—Ä–æ–µ–∫—Ç–µ ProebalStars</h2>
        <p>–≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –∫—Ä–∞—Å–∏–≤–æ –∏ —Å —Ä–∞–∑–º–∞—Ö–æ–º –ø—Ä–æ–µ–±–∞—Ç—å —Å–≤–æ–∏ Telegram Stars! üåü</p>
        <h3>‚≠êÔ∏è –ß—Ç–æ —Ç–∞–∫–æ–µ Stars?</h3>
        <p>Stars - —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ Telegram, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ Telegram Premium. –û–±—ã—á–Ω–æ Stars –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∞–Ω–∞–ª–æ–≤ –∏ –±–æ—Ç–æ–≤, –Ω–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –±–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è! üòé</p>
        <h3>ÔøΩÔøΩ –ó–∞—á–µ–º –ø—Ä–æ–µ–±—ã–≤–∞—Ç—å Stars?</h3>
        <ul>
            <li>üëë –î–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —ç–ª–∏—Ç–Ω—ã–π –∫–ª—É–± –ø—Ä–æ—ë–±—ã–≤–∞—Ç–µ–ª–µ–π</li>
            <li>üìú –†–∞–¥–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–ø—Ä–∞–≤–∫–∏</li>
            <li>üåü –ß—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é Telegram</li>
            <li>üéÅ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é —Ç–∞–π–Ω–æ–≥–æ –∫–æ–º—å—é–Ω–∏—Ç–∏</li>
            <li>üí™ –ü—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ–º!</li>
        </ul>
        <h3>üéÅ –°–µ–∫—Ä–µ—Ç—ã –±–æ–Ω—É—Å!</h3>
        <p>–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–º—å—é–Ω–∏—Ç–∏ –∏ –±–æ–ª—å—à–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É, –º—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å airdrop —Ç–∞–π–Ω–æ–π –º–æ–Ω–µ—Ç—ã –¥–ª—è —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!</p>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav">
        <button class="nav-button" onclick="showTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
        <button class="nav-button active" onclick="showTab('game')">‚è± –í—Ä–µ–º—è</button>
        <button class="nav-button" onclick="showTab('about')">‚ÑπÔ∏è –û –Ω–∞—Å</button>
    </div>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL –¥–ª—è API
        const API_BASE_URL = "https://89.111.169.43";

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–≥—Ä—ã
        let gameInterval;
        let gameTime = 0;
        let gameRecord = 0;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function showTab(tabId) {
            console.log("–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:", tabId);
            document.querySelectorAll(".content").forEach(tab => {
                tab.style.display = "none";
            });
            document.querySelectorAll(".nav-button").forEach(btn => {
                btn.classList.remove("active");
            });
            document.getElementById(tabId).style.display = "block";
            document.querySelector(`.nav-button[onclick="showTab('${tabId}'"]`).classList.add("active");

            if (tabId === "rating") {
                loadRating();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
        async function loadRating() {
            const ratingList = document.getElementById("ratingList");
            if (!ratingList) {
                console.error("–≠–ª–µ–º–µ–Ω—Ç ratingList –Ω–µ –Ω–∞–π–¥–µ–Ω");
                return;
            }

            try {
                ratingList.innerHTML = "<div class=\"rating-loading\">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞...</div>";
                
                const response = await fetch(`${API_BASE_URL}/api/get_rating`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json"
                    }
                });
                
                const data = await response.json();
                console.log("–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∞:", data);

                if (!data.top_users || !Array.isArray(data.top_users)) {
                    throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∞");
                }

                let html = "";
                if (data.top_users.length > 0) {
                    data.top_users.forEach((user, index) => {
                        const position = index + 1;
                        const medal = position <= 3 ? ["ü•á","ü•à","ü•â"][position-1] : "üëë";
                        
                        html += `
                            <div class="rating-item">
                                <div class="rating-position">${position}</div>
                                <div class="rating-medal">${medal}</div>
                                <div class="rating-info">
                                    <div class="rating-username">${user[0]}</div>
                                    <div class="rating-stars">
                                        ${parseFloat(user[2]).toFixed(4)}‚≠êÔ∏è
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = "<div class=\"rating-empty\">üò¥ –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–µ–±–∞–ª –Ω–∏ –æ–¥–Ω–æ–π Stars!</div>";
                }

                ratingList.innerHTML = html;

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:", error);
                ratingList.innerHTML = "<div class=\"rating-error\">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>";
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–≥—Ä—ã
        function toggleGame() {
            const button = document.getElementById("gameButton");
            const buttonText = button.querySelector(".game-button-text");
            const buttonIcon = button.querySelector(".game-button-icon");

            if (gameInterval) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä—É
                clearInterval(gameInterval);
                gameInterval = null;
                buttonText.textContent = "–ù–∞—á–∞—Ç—å –ø—Ä–æ—ë–± –≤—Ä–µ–º–µ–Ω–∏";
                buttonIcon.textContent = "‚ñ∂Ô∏è";
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∫–æ—Ä–¥
                if (gameTime > gameRecord) {
                    gameRecord = gameTime;
                    localStorage.setItem("gameRecord", gameRecord);
                    document.getElementById("gameRecord").textContent = gameRecord;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (tg.initDataUnsafe?.user?.id) {
                    fetch(`${API_BASE_URL}/api/save_score`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            user_id: tg.initDataUnsafe.user.id,
                            username: tg.initDataUnsafe.user.username,
                            score: gameTime
                        })
                    });
                }
                
                gameTime = 0;
                document.getElementById("gameTime").textContent = gameTime;
            } else {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
                buttonText.textContent = "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—ë–±";
                buttonIcon.textContent = "‚èπ";
                gameInterval = setInterval(() => {
                    gameTime++;
                    document.getElementById("gameTime").textContent = gameTime;
                }, 1000);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ—Ä–¥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        const savedRecord = localStorage.getItem("gameRecord");
        if (savedRecord) {
            gameRecord = parseInt(savedRecord);
            document.getElementById("gameRecord").textContent = gameRecord;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener("DOMContentLoaded", () => {
            showTab("game");
        });
    </script>
</body>
</html>
